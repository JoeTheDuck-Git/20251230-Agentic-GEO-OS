# Opportunity Analysis Page

## Purpose

The Opportunity Analysis page displays identified opportunities and pattern insights for improving GEO performance. Opportunities are identified by the Reasoning Agent and provide decision-friendly information with higher information density, master-detail interaction, and rich evidence.

## Page Route

`/decisions/opportunity-analysis`

## Data Source

- **Primary Agent**: Reasoning Agent
- **Data Type**: Read-only opportunities and pattern insights from agent outputs

## Page Sections

### A) Header
- Page title: "Opportunity Analysis"
- Subtitle: "Identified opportunities and pattern insights for improving GEO performance."
- Source attribution: Generated by Reasoning Agent with timestamp

### B) Read-Only Callout
- Clear statement: "Opportunities are identified by Reasoning Agent. No execution actions available."

### C) KPI Row (4 Cards)
1. **Opportunities**: Total count of identified opportunities
2. **High Priority**: Count of high-priority opportunities
3. **Estimated GEO Lift**: Demo range showing potential GEO score improvement (min-max %)
4. **Avg Confidence**: Average confidence percentage across all opportunities

### D) Filters Bar
- **Topic Filter**: Filter by topic (All Topics or specific topic)
- **Driver Filter**: Filter by driver type:
  - All Drivers
  - Reach
  - Position
  - Sentiment
  - Visibility
- **Priority Filter**: Filter by priority level (All / High / Medium / Low)
- **Sort**: Sort opportunities by:
  - Impact (default): Calculated by reach improvement + position improvement
  - Confidence: Sort by confidence percentage
  - Priority: Sort by priority level (high > medium > low)
  - Effort: Sort by effort level (S < M < L)

All filters are client-side only (no API calls).

### E) Opportunities (Master-Detail Layout)

#### Left Panel: Opportunities List
Each opportunity row displays:
- **Title** + **Topic name**
- **Driver chips**: Visual badges showing which drivers are involved:
  - Reach gap (blue)
  - Position gap (purple)
  - Sentiment gap (orange)
  - Visibility gap (indigo)
- **Current → Target**: Shows current and target values for:
  - Reach (percentage)
  - Avg Position (numeric)
- **Priority badge**: High (red) / Medium (yellow) / Low (green)
- **Confidence %**: Percentage confidence in the opportunity
- **Effort badge**: S (Small, green) / M (Medium, yellow) / L (Large, red)
- **Patterns count**: Number of question patterns to address
- **Top 3 pattern chips**: Pattern chips showing top patterns (with tooltips showing examples)

Clicking a row selects it and shows details in the right panel.

#### Right Panel: Selected Opportunity Details
When an opportunity is selected, displays:

1. **Header Section**:
   - Opportunity title
   - Topic badge
   - Priority badge
   - Effort badge

2. **Rationale**:
   - 1-2 sentence explanation of why this opportunity exists

3. **Signals Used**:
   - Bulleted list of signals that led to this opportunity identification

4. **Pattern Coverage**:
   - Patterns count: Total number of question patterns to address
   - Top 3 pattern chips: Pattern chips from the canonical pattern library (see `/docs/ui/glossary-geo.md`)
   - Tooltips on chips show example questions for each pattern

5. **Evidence Snapshot**:
   - **Question Patterns** (if available): Common question patterns related to this opportunity
   - **Competitor Advantage** (if available): Information about competitor positioning
   - **Sentiment Notes** (if available): Sentiment-related observations

6. **Links** (read-only navigation):
   - "View related Actionable Item" → Links to `/decisions/actionable-items?from=<item_id>`
   - "View Execution Brief" → Links to `/execution-prep/execution-briefs?brief=<brief_id>` (if available)
   - Shows "No related items available" if neither link exists

### F) Pattern Insights
Rendered as multiple cards (3-5) instead of a single paragraph. Each insight card includes:

- **Type badge**: Visual indicator for pattern type:
  - Correlation (blue)
  - Gap cluster (purple)
  - Volatility (orange)
  - Sentiment risk (red)
- **Statement**: The pattern insight description
- **Confidence %**: Confidence level for this pattern
- **What to watch**: One-line guidance on what to monitor
- **Related topics chips**: Badges showing which topics are related to this pattern

## Driver Definitions

See `/docs/ui/glossary-geo.md` for complete driver and gap definitions. All driver and gap chips on this page use shared definitions and the `DriverChip` component for consistent terminology and tooltips.

## Read-Only Boundary

### What This Page Does
- ✅ Displays opportunities identified by Reasoning Agent
- ✅ Shows pattern insights for strategic understanding
- ✅ Allows filtering and sorting (client-side only)
- ✅ Provides master-detail interaction for opportunity exploration
- ✅ Shows evidence and signals for each opportunity
- ✅ Provides navigation links to related Actionable Items and Execution Briefs
- ✅ Displays KPIs for quick overview

### What This Page Does NOT Do
- ❌ Execute any actions
- ❌ Trigger agent calls
- ❌ Create or assign tasks
- ❌ Schedule or publish content
- ❌ Modify data
- ❌ Track execution status
- ❌ Show action plans or timelines

## Navigation Handoffs

### To Actionable Items
- Link: "View related Actionable Item"
- Navigation: `/decisions/actionable-items?from=<item_id>`
- Navigation-only action (no data transfer)

### To Execution Briefs
- Link: "View Execution Brief"
- Navigation: `/execution-prep/execution-briefs?brief=<brief_id>`
- Navigation-only action (no data transfer)
- Only shown if `related_execution_brief_id` exists

## UI Patterns

### Allowed Patterns
- View-only data display
- Client-side filtering and sorting
- Master-detail layout
- Badges for categorization
- Navigation links
- Read-only evidence display

### Forbidden Patterns
- Execution buttons
- "Generate", "Execute", "Publish" wording
- Task management UI
- API calls
- Agent execution triggers
- Publishing controls
- Status tracking

## Data Structure

The page uses demo data from `/lib/demo/geo-os/opportunity-analysis.ts` with the following structure:

- `meta`: Page metadata, snapshot ID, source agent, boundary
- `kpis`: KPI values (opportunities count, high priority count, estimated GEO lift range, avg confidence)
- `opportunities[]`: Array of opportunities, each containing:
  - `opportunity_id`: Unique identifier
  - `title`: Opportunity title
  - `topic_id` / `topic_name`: Topic information
  - `driver`: Primary driver type
  - `drivers`: Array of driver gaps involved
  - `current_state`: Current reach and avg_position
  - `target_state`: Target reach and avg_position
  - `priority`: Priority level (high/medium/low)
  - `confidence`: 0-1 confidence score
  - `effort`: Effort level (S/M/L, demo only)
  - `rationale`: 1-2 sentence explanation
  - `signals_used`: Array of signal strings
  - `evidence_snapshot`: Object with optional question_patterns, competitor_advantage, sentiment_notes
  - `related_actionable_item_id`: Optional link to actionable item
  - `related_execution_brief_id`: Optional link to execution brief
- `pattern_insights[]`: Array of pattern insights, each containing:
  - `pattern_id`: Unique identifier
  - `type`: Pattern type (correlation/gap_cluster/volatility/sentiment_risk)
  - `statement`: Pattern description
  - `confidence`: 0-1 confidence score
  - `what_to_watch`: One-line monitoring guidance
  - `related_topics`: Array of related topic names

## Agent Attribution

- **Reasoning Agent**: Primary source for all opportunities and pattern insights
- All data is read-only and snapshot-based
- Opportunities are identified through analysis of GEO signals

## Future Considerations

When backend integration is added:
- Replace demo data with API calls
- Add loading states
- Add error handling
- Implement snapshot selection
- Add time range filtering
- Consider adding opportunity comparison view
- Add export functionality for opportunities

